<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>PMF widget</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 10px 30px rgba(0,0,0,0.06);
      --radius: 14px;
    }

    body {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 18px;
    }

    .topbar {
      max-width: 1400px;
      margin: 0 auto 14px auto;
      padding: 16px 18px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .title {
      font-size: 20px;
      font-weight: 650;
      line-height: 1.25;
      margin: 0;
    }

    .wrap {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 14px;
      align-items: start;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px;
    }

    #plotCard {
      padding: 10px 12px 6px 12px;
    }

    #plot {
      width: 100%;
      height: 82vh;
    }

    .row { margin: 10px 0; }
    .muted { color: var(--muted); font-size: 12.5px; line-height: 1.35; }
    .hr { height: 1px; background: var(--border); margin: 12px 0; }

    .btns { display: flex; gap: 8px; }
    button {
      border: 1px solid var(--border);
      background: #fff;
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
    }
    button:hover { background: #f9fafb; }

    .sectionTitle {
      font-size: 13px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin: 12px 0 6px 0;
    }

    .item {
      display: grid;
      grid-template-columns: 18px 1fr 34px;
      gap: 10px;
      align-items: center;
      padding: 6px 8px;
      border-radius: 10px;
    }
    .item:hover { background: #f9fafb; }

    .labelText {
      font-size: 14px;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    input[type="color"] {
      width: 34px;
      height: 24px;
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;
    }

    input[type="checkbox"] {
      transform: translateY(1px);
    }

    .note {
      font-size: 12.5px;
      color: var(--muted);
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="topbar">
    <h1 class="title">A Goldilocks zone of DNA flexibility defines stable yet1 plastic nucleosomes, tuned by histone chemistry</h1>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="btns row">
        <button onclick="showAll()">Show all</button>
        <button onclick="hideAll()">Hide all</button>
      </div>

      <div class="hr"></div>

      <div class="muted">Shaded region indicates Standard Deviation.</div>

      <div class="hr"></div>

      <div id="controls"></div>

      <div class="note">Tip: you can also click legend items to hide/show lines.</div>
    </div>

    <div class="panel" id="plotCard">
      <div id="plot"></div>
    </div>
  </div>

<script>
const DATA = {"items": [{"id": "Natural::1KX5", "group": "Natural", "label": "1KX5", "default_color": "#1f77b4"}, {"id": "Artificial::1KX5_copia", "group": "Artificial", "label": "1KX5_copia", "default_color": "#ff7f0e"}], "groups": {"Natural": [0], "Artificial": [1]}, "data": {"Natural::1KX5": {"coor": [26.7375, 30.2125, 33.6875, 37.1625, 40.6375, 44.1125, 47.5875, 51.0625, 54.5375, 58.0125, 61.4875, 64.9625, 68.4375, 71.9125, 75.3875, 78.8625, 82.3375, 85.8125, 89.2875, 92.7625, 96.2375, 99.7125, 103.1875, 106.6625, 110.1375, 113.6125, 117.0875, 120.5625, 124.0375, 127.5125, 130.9875, 134.4625, 137.9375, 141.4125, 144.8875, 148.3625, 151.8375, 155.3125, 158.7875, 162.2625, 165.7375, 169.2125, 172.6875, 176.1625, 179.6375, 183.1125, 186.5875, 190.0625, 193.5375, 197.0125, 200.4875, 203.9625, 207.4375, 210.9125, 214.3875, 217.8625, 221.3375, 224.8125, 228.2875, 231.7625, 235.2375, 238.7125, 242.1875, 245.6625, 249.1375, 252.6125, 256.0875, 259.5625, 263.0375, 266.5125, 269.9875, 273.4625, 276.9375, 280.4125, 283.8875, 287.3625, 290.8375, 294.3125, 297.7875, 301.2625, 304.7375, 308.2125, 311.6875, 315.1625, 318.6375, 322.1125, 325.5875, 329.0625, 332.5375, 336.0125, 339.4875, 342.9625, 346.4375, 349.9125, 353.3875, 356.8625, 360.3375, 363.8125, 367.2875, 370.7625, 374.2375, 377.7125, 381.1875, 384.6625, 388.1375, 391.6125, 395.0875, 398.5625, 402.0375, 405.5125, 408.9875, 412.4625, 415.9375, 419.4125, 422.8875, 426.3625, 429.8375, 433.3125, 436.7875, 440.2625, 443.7375, 447.2125, 450.6875, 454.1625, 457.6375, 461.1125, 464.5875, 468.0625, 471.5375, 475.0125, 478.4875, 481.9625, 485.4375, 488.9125, 492.3875, 495.8625, 499.3375, 502.8125, 506.2875, 509.7625, 513.2375, 516.7125, 520.1875, 523.6625, 527.1375, 530.6125, 534.0875, 537.5625, 541.0375, 544.5125, 547.9875, 551.4625, 554.9375, 558.4125, 561.8875, 565.3625, 568.8375, 572.3125, 575.7875, 579.2625, 582.7375, 586.2125, 589.6875, 593.1625, 596.6375, 600.1125, 603.5875, 607.0625, 610.5375, 614.0125, 617.4875, 620.9625, 624.4375, 627.9125, 631.3875, 634.8625, 638.3375, 641.8125, 645.2875, 648.7625, 652.2375, 655.7125, 659.1875, 662.6625, 666.1375, 669.6125, 673.0875, 676.5625, 680.0375, 683.5125, 686.9875, 690.4625, 693.9375, 697.4125, 700.8875, 704.3625, 707.8375, 711.3125, 714.7875, 718.2625], "free_mean": [1.1985242, 0.8567045999999999, 0.5869981999999999, 0.42823839999999996, 0.31317680000000003, 0.23208200000000004, 0.21797920000000004, 0.1882044, 0.15969100000000003, 0.1502218, 0.13693660000000002, 0.0986078, 0.09456679999999999, 0.0953472, 0.10778500000000002, 0.15139640000000001, 0.18898359999999997, 0.20661100000000002, 0.2343656, 0.27610140000000005, 0.31594920000000004, 0.3492346, 0.420223, 0.4779522, 0.5248832, 0.5697286, 0.6182842, 0.6652858, 0.7100238, 0.7505868, 0.8319873999999998, 0.8747098000000001, 0.901908, 0.9666018000000001, 1.0347286, 1.1049866, 1.1709391999999998, 1.2303419999999998, 1.2932602, 1.367558, 1.4586036, 1.5484940000000003, 1.6242834, 1.724247, 1.8184571999999999, 1.921462, 2.0402308000000002, 2.1578646, 2.3577687999999997, 2.5489506, 2.7734761999999997, 2.9963712, 3.2195735999999995, 3.4784677999999998, 3.7482612000000004, 4.0102096000000005, 4.2560952, 4.511791400000001, 4.739059800000001, 4.9752212, 5.2058202, 5.4350326, 5.6833206, 5.913498, 6.135157, 6.319221399999999, 6.5340666, 6.737957400000001, 6.9223495999999995, 7.1141706, 7.3090285999999995, 7.492935800000001, 7.659546599999999, 7.8644644, 8.081776999999999, 8.2656402, 8.4193388, 8.5176588, 8.614544800000001, 8.693540200000001, 8.7943614, 8.885390000000001, 8.9808222, 9.0583544, 9.1305776, 9.206005000000001, 9.285683, 9.380675400000001, 9.472714999999999, 9.5494236, 9.6731758, 9.7614824, 9.861125600000001, 9.962048200000002, 10.1025392, 10.261597599999998, 10.4152442, 10.5902674, 10.7534264, 10.9108682, 11.1314362, 11.399367000000002, 11.669820600000001, 11.972406000000001, 12.3019148, 12.6759826, 13.092728, 13.5640962, 14.052876600000001, 14.5892442, 15.164152999999999, 15.779737, 16.4306112, 17.0942122, 17.814324000000003, 18.5388132, 19.2934858, 20.1053696, 21.0290964, 22.115676, 23.2513038, 24.4843544, 25.785887199999998, 27.199801400000002, 28.7187474, 30.271326199999997, 31.9035712, 33.4439406, 34.7865036, 35.934497199999996, 36.8748724, 37.785437200000004, 38.7690338, 39.821322, 40.8208702, 41.6500262, 42.30267, 42.9229778, 43.59013, 44.1952904, 44.753704, 45.2813186, 45.785461, 46.252492, 46.7274652, 47.225186, 47.706731000000005, 48.1861476, 48.6797918, 49.1589292, 49.6978252, 50.2399682, 50.777517599999996, 51.350054, 51.976695199999995, 52.628955, 53.2619314, 53.9200118, 54.5833978, 55.2112036, 55.8969348, 56.6111272, 57.3375038, 58.0922972, 58.8598436, 59.60405999999999, 60.2935428, 60.955395599999996, 61.637371800000004, 62.31805919999999, 63.007032200000005, 63.674396200000004, 64.3712572, 65.1086932, 65.81134920000001, 66.4836152, 67.218963, 67.9933674, 68.82985140000001, 69.70055599999999, 70.6773624, 71.642607, 72.635006, 73.6882974, 74.8008378, 75.98521099999999, 77.2940296, 78.67102300000002, 80.1553438, 81.76111800000001, 83.4562988, 85.2767614, 87.23301699999999, 89.342627, 91.59583219999999, 93.9702836, 96.5260196, 99.16340020000001, 101.5879944, 102.8226976], "free_sd": [0.6160380834645697, 0.6124263890593711, 0.5643272025409549, 0.516929581092338, 0.47466807828808116, 0.43313225101405234, 0.3610427783624816, 0.2952693637143887, 0.2592912733481403, 0.21953266000005559, 0.14483663229411267, 0.12126004046964524, 0.09019321982388698, 0.06839238653315148, 0.0848240350342991, 0.08318516435218483, 0.11749815825067217, 0.1393998830451446, 0.18000527732347185, 0.20986607674848262, 0.20916363111975275, 0.21645902541428017, 0.2590119633848985, 0.28914410047794503, 0.298410494231855, 0.3311120182608901, 0.34142651201129653, 0.3527187678947634, 0.3739614420882185, 0.39374083916860847, 0.3998098765041954, 0.40530579105620973, 0.42167293163362995, 0.4224480786104962, 0.4429950416464049, 0.46018637558960823, 0.47834137378623226, 0.5023951590058366, 0.5020654495020545, 0.5296945952447505, 0.538592862676252, 0.5562877954395548, 0.5837524297031234, 0.606450142731041, 0.6247334213500187, 0.6408438098355168, 0.6558359384798153, 0.6559649157495392, 0.6806695687965637, 0.7018732772444041, 0.6884499333202816, 0.6577270751472074, 0.6444214986461112, 0.6640177168650699, 0.6908774000813749, 0.7424604909322113, 0.7387388493332404, 0.7455761968546877, 0.7410037240707366, 0.7622365404844483, 0.7699532202245797, 0.7673552681596055, 0.8085068005222963, 0.8018433950825434, 0.7615328341821511, 0.7201589760308483, 0.7309547732269763, 0.7789581543165847, 0.8355115819887236, 0.8598310650681913, 0.8202919348416754, 0.7191267336173784, 0.6554440609905625, 0.5780632365968277, 0.5667883645925522, 0.551101207281113, 0.5724949799764186, 0.6275392865751115, 0.6925781772137353, 0.7500720639696566, 0.8166885993536942, 0.8629516476550115, 0.8846397698635299, 0.9095193471869079, 0.9251240707887773, 0.9692620885988479, 0.9952555776030598, 1.032882264200668, 1.0413065847549416, 1.0610985304806997, 1.0646471839758467, 1.044786634115694, 0.9891748673299886, 0.9476851549853991, 0.9485233177010987, 0.9626387413128045, 0.9821663275518563, 0.9958831072012418, 0.9841703837935281, 0.9579084260450992, 0.9207825273905341, 0.8769817361556054, 0.8654338187425425, 0.8356308480878387, 0.8486221222609628, 0.8508800262347807, 0.871151684418678, 0.9139143433723427, 0.9547932041407186, 0.9719893595640335, 0.9951852797140335, 0.9991547448210913, 0.9917242431597098, 1.005372112060356, 1.083457226285837, 1.1314756591180828, 1.1722569941090997, 1.202019079039222, 1.213372252457505, 1.2276984970459968, 1.273604973313037, 1.288166069819532, 1.3444667561039578, 1.4272949623181603, 1.417943462816236, 1.3910880431932415, 1.47744552877617, 1.5824553271006725, 1.8204933804277628, 1.967696594120825, 1.9950145167018953, 2.0671637298630237, 2.195033450444708, 2.33126870726242, 2.5512664016011146, 2.806692195092509, 2.9781446499161186, 3.1081305636390515, 3.2121155429476698, 3.344706659032792, 3.4990197905996463, 3.644437381221455, 3.784232653538497, 3.918782831051435, 4.013038323362139, 4.110179708248899, 4.205271067070528, 4.228996328301529, 4.231286375022931, 4.2616052079246725, 4.240934634949787, 4.201977812041992, 4.171476007302006, 4.138431832982575, 4.1357553086757575, 4.147102817516104, 4.147713479080408, 4.094011330881573, 4.051362194182186, 4.035476811728547, 4.021737660732694, 4.031319110850032, 4.027298642866295, 4.04212679891152, 4.079699887416024, 4.126755487088437, 4.116313915900815, 4.0905358249678985, 4.043394501554811, 4.018268739633672, 4.048141073277053, 4.054771459000766, 4.054489207906242, 4.079817076753467, 4.171192298088244, 4.298748445202244, 4.4092925882254095, 4.507727449350873, 4.565511700118817, 4.623047056333251, 4.6895537090199495, 4.666032974047705, 4.59502981923986, 4.541755659433617, 4.565495255247861, 4.560092354533676, 4.515899141813933, 4.477411225011002, 4.42577808875193, 4.366728094512637, 4.324495310474588, 4.281074066718047, 4.203708294300166, 4.108237207526361, 4.0255567257868465, 3.9137132588693566, 3.810244003857271, 3.7325751273314256, 4.162879763627798, 4.267021866918692]}, "Artificial::1KX5_copia": {"coor": [26.7375, 30.2125, 33.6875, 37.1625, 40.6375, 44.1125, 47.5875, 51.0625, 54.5375, 58.0125, 61.4875, 64.9625, 68.4375, 71.9125, 75.3875, 78.8625, 82.3375, 85.8125, 89.2875, 92.7625, 96.2375, 99.7125, 103.1875, 106.6625, 110.1375, 113.6125, 117.0875, 120.5625, 124.0375, 127.5125, 130.9875, 134.4625, 137.9375, 141.4125, 144.8875, 148.3625, 151.8375, 155.3125, 158.7875, 162.2625, 165.7375, 169.2125, 172.6875, 176.1625, 179.6375, 183.1125, 186.5875, 190.0625, 193.5375, 197.0125, 200.4875, 203.9625, 207.4375, 210.9125, 214.3875, 217.8625, 221.3375, 224.8125, 228.2875, 231.7625, 235.2375, 238.7125, 242.1875, 245.6625, 249.1375, 252.6125, 256.0875, 259.5625, 263.0375, 266.5125, 269.9875, 273.4625, 276.9375, 280.4125, 283.8875, 287.3625, 290.8375, 294.3125, 297.7875, 301.2625, 304.7375, 308.2125, 311.6875, 315.1625, 318.6375, 322.1125, 325.5875, 329.0625, 332.5375, 336.0125, 339.4875, 342.9625, 346.4375, 349.9125, 353.3875, 356.8625, 360.3375, 363.8125, 367.2875, 370.7625, 374.2375, 377.7125, 381.1875, 384.6625, 388.1375, 391.6125, 395.0875, 398.5625, 402.0375, 405.5125, 408.9875, 412.4625, 415.9375, 419.4125, 422.8875, 426.3625, 429.8375, 433.3125, 436.7875, 440.2625, 443.7375, 447.2125, 450.6875, 454.1625, 457.6375, 461.1125, 464.5875, 468.0625, 471.5375, 475.0125, 478.4875, 481.9625, 485.4375, 488.9125, 492.3875, 495.8625, 499.3375, 502.8125, 506.2875, 509.7625, 513.2375, 516.7125, 520.1875, 523.6625, 527.1375, 530.6125, 534.0875, 537.5625, 541.0375, 544.5125, 547.9875, 551.4625, 554.9375, 558.4125, 561.8875, 565.3625, 568.8375, 572.3125, 575.7875, 579.2625, 582.7375, 586.2125, 589.6875, 593.1625, 596.6375, 600.1125, 603.5875, 607.0625, 610.5375, 614.0125, 617.4875, 620.9625, 624.4375, 627.9125, 631.3875, 634.8625, 638.3375, 641.8125, 645.2875, 648.7625, 652.2375, 655.7125, 659.1875, 662.6625, 666.1375, 669.6125, 673.0875, 676.5625, 680.0375, 683.5125, 686.9875, 690.4625, 693.9375, 697.4125, 700.8875, 704.3625, 707.8375, 711.3125, 714.7875, 718.2625], "free_mean": [1.1985242, 0.8567045999999999, 0.5869981999999999, 0.42823839999999996, 0.31317680000000003, 0.23208200000000004, 0.21797920000000004, 0.1882044, 0.15969100000000003, 0.1502218, 0.13693660000000002, 0.0986078, 0.09456679999999999, 0.0953472, 0.10778500000000002, 0.15139640000000001, 0.18898359999999997, 0.20661100000000002, 0.2343656, 0.27610140000000005, 0.31594920000000004, 0.3492346, 0.420223, 0.4779522, 0.5248832, 0.5697286, 0.6182842, 0.6652858, 0.7100238, 0.7505868, 0.8319873999999998, 0.8747098000000001, 0.901908, 0.9666018000000001, 1.0347286, 1.1049866, 1.1709391999999998, 1.2303419999999998, 1.2932602, 1.367558, 1.4586036, 1.5484940000000003, 1.6242834, 1.724247, 1.8184571999999999, 1.921462, 2.0402308000000002, 2.1578646, 2.3577687999999997, 2.5489506, 2.7734761999999997, 2.9963712, 3.2195735999999995, 3.4784677999999998, 3.7482612000000004, 4.0102096000000005, 4.2560952, 4.511791400000001, 4.739059800000001, 4.9752212, 5.2058202, 5.4350326, 5.6833206, 5.913498, 6.135157, 6.319221399999999, 6.5340666, 6.737957400000001, 6.9223495999999995, 7.1141706, 7.3090285999999995, 7.492935800000001, 7.659546599999999, 7.8644644, 8.081776999999999, 8.2656402, 8.4193388, 8.5176588, 8.614544800000001, 8.693540200000001, 8.7943614, 8.885390000000001, 8.9808222, 9.0583544, 9.1305776, 9.206005000000001, 9.285683, 9.380675400000001, 9.472714999999999, 9.5494236, 9.6731758, 9.7614824, 9.861125600000001, 9.962048200000002, 10.1025392, 10.261597599999998, 10.4152442, 10.5902674, 10.7534264, 10.9108682, 11.1314362, 11.399367000000002, 11.669820600000001, 11.972406000000001, 12.3019148, 12.6759826, 13.092728, 13.5640962, 14.052876600000001, 14.5892442, 15.164152999999999, 15.779737, 16.4306112, 17.0942122, 17.814324000000003, 18.5388132, 19.2934858, 20.1053696, 21.0290964, 22.115676, 23.2513038, 24.4843544, 25.785887199999998, 27.199801400000002, 28.7187474, 30.271326199999997, 31.9035712, 33.4439406, 34.7865036, 35.934497199999996, 36.8748724, 37.785437200000004, 38.7690338, 39.821322, 40.8208702, 41.6500262, 42.30267, 42.9229778, 43.59013, 44.1952904, 44.753704, 45.2813186, 45.785461, 46.252492, 46.7274652, 47.225186, 47.706731000000005, 48.1861476, 48.6797918, 49.1589292, 49.6978252, 50.2399682, 50.777517599999996, 51.350054, 51.976695199999995, 52.628955, 53.2619314, 53.9200118, 54.5833978, 55.2112036, 55.8969348, 56.6111272, 57.3375038, 58.0922972, 58.8598436, 59.60405999999999, 60.2935428, 60.955395599999996, 61.637371800000004, 62.31805919999999, 63.007032200000005, 63.674396200000004, 64.3712572, 65.1086932, 65.81134920000001, 66.4836152, 67.218963, 67.9933674, 68.82985140000001, 69.70055599999999, 70.6773624, 71.642607, 72.635006, 73.6882974, 74.8008378, 75.98521099999999, 77.2940296, 78.67102300000002, 80.1553438, 81.76111800000001, 83.4562988, 85.2767614, 87.23301699999999, 89.342627, 91.59583219999999, 93.9702836, 96.5260196, 99.16340020000001, 101.5879944, 102.8226976], "free_sd": [0.6160380834645697, 0.6124263890593711, 0.5643272025409549, 0.516929581092338, 0.47466807828808116, 0.43313225101405234, 0.3610427783624816, 0.2952693637143887, 0.2592912733481403, 0.21953266000005559, 0.14483663229411267, 0.12126004046964524, 0.09019321982388698, 0.06839238653315148, 0.0848240350342991, 0.08318516435218483, 0.11749815825067217, 0.1393998830451446, 0.18000527732347185, 0.20986607674848262, 0.20916363111975275, 0.21645902541428017, 0.2590119633848985, 0.28914410047794503, 0.298410494231855, 0.3311120182608901, 0.34142651201129653, 0.3527187678947634, 0.3739614420882185, 0.39374083916860847, 0.3998098765041954, 0.40530579105620973, 0.42167293163362995, 0.4224480786104962, 0.4429950416464049, 0.46018637558960823, 0.47834137378623226, 0.5023951590058366, 0.5020654495020545, 0.5296945952447505, 0.538592862676252, 0.5562877954395548, 0.5837524297031234, 0.606450142731041, 0.6247334213500187, 0.6408438098355168, 0.6558359384798153, 0.6559649157495392, 0.6806695687965637, 0.7018732772444041, 0.6884499333202816, 0.6577270751472074, 0.6444214986461112, 0.6640177168650699, 0.6908774000813749, 0.7424604909322113, 0.7387388493332404, 0.7455761968546877, 0.7410037240707366, 0.7622365404844483, 0.7699532202245797, 0.7673552681596055, 0.8085068005222963, 0.8018433950825434, 0.7615328341821511, 0.7201589760308483, 0.7309547732269763, 0.7789581543165847, 0.8355115819887236, 0.8598310650681913, 0.8202919348416754, 0.7191267336173784, 0.6554440609905625, 0.5780632365968277, 0.5667883645925522, 0.551101207281113, 0.5724949799764186, 0.6275392865751115, 0.6925781772137353, 0.7500720639696566, 0.8166885993536942, 0.8629516476550115, 0.8846397698635299, 0.9095193471869079, 0.9251240707887773, 0.9692620885988479, 0.9952555776030598, 1.032882264200668, 1.0413065847549416, 1.0610985304806997, 1.0646471839758467, 1.044786634115694, 0.9891748673299886, 0.9476851549853991, 0.9485233177010987, 0.9626387413128045, 0.9821663275518563, 0.9958831072012418, 0.9841703837935281, 0.9579084260450992, 0.9207825273905341, 0.8769817361556054, 0.8654338187425425, 0.8356308480878387, 0.8486221222609628, 0.8508800262347807, 0.871151684418678, 0.9139143433723427, 0.9547932041407186, 0.9719893595640335, 0.9951852797140335, 0.9991547448210913, 0.9917242431597098, 1.005372112060356, 1.083457226285837, 1.1314756591180828, 1.1722569941090997, 1.202019079039222, 1.213372252457505, 1.2276984970459968, 1.273604973313037, 1.288166069819532, 1.3444667561039578, 1.4272949623181603, 1.417943462816236, 1.3910880431932415, 1.47744552877617, 1.5824553271006725, 1.8204933804277628, 1.967696594120825, 1.9950145167018953, 2.0671637298630237, 2.195033450444708, 2.33126870726242, 2.5512664016011146, 2.806692195092509, 2.9781446499161186, 3.1081305636390515, 3.2121155429476698, 3.344706659032792, 3.4990197905996463, 3.644437381221455, 3.784232653538497, 3.918782831051435, 4.013038323362139, 4.110179708248899, 4.205271067070528, 4.228996328301529, 4.231286375022931, 4.2616052079246725, 4.240934634949787, 4.201977812041992, 4.171476007302006, 4.138431832982575, 4.1357553086757575, 4.147102817516104, 4.147713479080408, 4.094011330881573, 4.051362194182186, 4.035476811728547, 4.021737660732694, 4.031319110850032, 4.027298642866295, 4.04212679891152, 4.079699887416024, 4.126755487088437, 4.116313915900815, 4.0905358249678985, 4.043394501554811, 4.018268739633672, 4.048141073277053, 4.054771459000766, 4.054489207906242, 4.079817076753467, 4.171192298088244, 4.298748445202244, 4.4092925882254095, 4.507727449350873, 4.565511700118817, 4.623047056333251, 4.6895537090199495, 4.666032974047705, 4.59502981923986, 4.541755659433617, 4.565495255247861, 4.560092354533676, 4.515899141813933, 4.477411225011002, 4.42577808875193, 4.366728094512637, 4.324495310474588, 4.281074066718047, 4.203708294300166, 4.108237207526361, 4.0255567257868465, 3.9137132588693566, 3.810244003857271, 3.7325751273314256, 4.162879763627798, 4.267021866918692]}}};

function rgbaFromHex(hex, alpha) {
  const h = hex.replace("#","").trim();
  const r = parseInt(h.slice(0,2), 16);
  const g = parseInt(h.slice(2,4), 16);
  const b = parseInt(h.slice(4,6), 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function getState() {
  // read checkbox + color picker values
  const state = {};
  DATA.items.forEach((it, idx) => {
    const cb = document.getElementById("cb_" + idx);
    const col = document.getElementById("col_" + idx);
    state[it.id] = {
      visible: cb.checked,
      color: col.value
    };
  });
  return state;
}

function tracesFor(item, colorHex, visible) {
  const d = DATA.data[item.id];
  const x = d.coor;
  const mean = d.free_mean;
  const sd = d.free_sd;

  const xPoly = x.concat([...x].reverse());
  const yUpper = mean.map((v,i) => v + sd[i]);
  const yLower = mean.map((v,i) => v - sd[i]).reverse();
  const yPoly = yUpper.concat(yLower);

  const fill = rgbaFromHex(colorHex, 0.8); // alpha 80%

  return [
    // SD band
    {
      x: xPoly, y: yPoly,
      type: "scatter",
      mode: "lines",
      line: {width: 0},
      fill: "toself",
      fillcolor: fill,
      hoverinfo: "skip",
      showlegend: false,
      visible: visible ? true : "legendonly"
    },
    // mean line
    {
      x: x, y: mean,
      type: "scatter",
      mode: "lines",
      name: item.label,   // legend shows label only (not group)
      line: {color: colorHex, width: 2.5},
      visible: visible ? true : "legendonly"
    }
  ];
}

function redraw() {
  const state = getState();
  const traces = [];

  DATA.items.forEach((it) => {
    const st = state[it.id];
    traces.push(...tracesFor(it, st.color, st.visible));
  });

  const layout = {
    xaxis: { title: "Extension (Ã…)" },
    yaxis: { title: "Free Energy (kcal/mol)" },
    hovermode: "x unified",
    margin: { l: 85, r: 18, t: 10, b: 65 },
    legend: { bgcolor: "rgba(255,255,255,0.7)", bordercolor: "rgba(0,0,0,0.08)", borderwidth: 1 }
  };

  Plotly.newPlot("plot", traces, layout, {responsive: true, displaylogo: false});
}

function buildControls() {
  const root = document.getElementById("controls");
  root.innerHTML = "";

  const groups = DATA.groups; // {Natural:[itemIdx...], Artificial:[...]}
  Object.keys(groups).forEach((gname) => {
    const h = document.createElement("div");
    h.className = "sectionTitle";
    h.textContent = gname;
    root.appendChild(h);

    groups[gname].forEach((idx) => {
      const it = DATA.items[idx];

      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `
        <input type="checkbox" id="cb_${idx}" checked>
        <div class="labelText" title="${it.label}">${it.label}</div>
        <input type="color" id="col_${idx}" value="${it.default_color}">
      `;
      root.appendChild(row);

      document.getElementById("cb_" + idx).addEventListener("change", redraw);
      document.getElementById("col_" + idx).addEventListener("input", redraw);
    });

    const spacer = document.createElement("div");
    spacer.style.height = "8px";
    root.appendChild(spacer);
  });
}

function showAll() {
  DATA.items.forEach((_, idx) => { document.getElementById("cb_" + idx).checked = true; });
  redraw();
}
function hideAll() {
  DATA.items.forEach((_, idx) => { document.getElementById("cb_" + idx).checked = false; });
  redraw();
}

buildControls();
redraw();
</script>
</body>
</html>
